<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>G·ªçi B·ªánh Nh√¢n - Xu√¢n Tr∆∞·ªùng</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #fdfdfd; margin: 20px; text-align: center; }
    h1 { background-color: #ffe066; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 26px; }
    .button-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 30px; }
    
    /* N√öT XANH B√åNH TH∆Ø·ªúNG */
    button.audio-btn { 
      width: 150px; height: 55px; background-color: #4CAF50; color: white; 
      font-size: 16px; font-weight: bold; border: 2px solid #2e7d32; border-radius: 12px; 
      cursor: pointer; transition: all 0.2s; 
    }
    button.audio-btn:active { transform: scale(0.9); }

    /* M√ÄU ƒê·ªé KHI ƒê√É ƒê∆Ø·ª¢C G·ªåI - PH·∫¢I C√ì !IMPORTANT */
    button.audio-btn.active { 
      background-color: #d32f2f !important; 
      border-color: #b71c1c !important; 
      box-shadow: inset 0 3px 5px rgba(0,0,0,0.3) !important;
    }

    .reset-btn { position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; z-index: 999; }
    .tts-container { margin-top: 30px; padding: 20px; background: #eee; border-radius: 15px; display: inline-block; }
    .tts-input { padding: 10px; width: 200px; border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h1>üè• G·ªåI B·ªÜNH NH√ÇN XU√ÇN TR∆Ø·ªúNG</h1>

  <div class="button-container" id="buttonContainer"></div>

  <div class="tts-container">
    <h3>G·ªçi t·ª± do (G√µ g√¨ ƒë·ªçc n·∫•y)</h3>
    <input type="text" id="ttsInput" class="tts-input" placeholder="V√≠ d·ª•: M·ªùi s·ªë 500">
    <button onclick="playTTS()" style="padding: 10px; background: #ff9800; color: white; border-radius: 8px; border: none; cursor: pointer;">Ph√°t Loa</button>
  </div>

  <button class="reset-btn" onclick="resetAll()">üîÑ L√ÄM M·ªöI DANH S√ÅCH</button>
  <audio id="audioPlayer" style="display:none;"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA0n0eH-9YOeqmNhQZQooc_wmbQhq9j718",
      authDomain: "ung-dung-y-te-8289b.firebaseapp.com",
      databaseURL: "https://ung-dung-y-te-8289b-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ung-dung-y-te-8289b",
      appId: "1:291727072122:web:7109ad07009512337214c3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const links = ["1-2", "3-4", "5-6", "7-8", "9-10", "11-12", "13-14", "15-16", "17-18", "19-20", "21-22", "23-24", "25-26", "27-28", "29-30", "31-32", "33-34", "35-36", "37-38", "39-40", "41-42", "43-44", "45-46", "47-48", "49-50"];

    const container = document.getElementById("buttonContainer");
    const audio = document.getElementById("audioPlayer");
    
    // ƒê∆Ø·ªúNG D·∫™N ƒê·ªíNG B·ªò - ƒê√É KH·ªöP V·ªöI H√åNH ƒê·∫†I CA G·ª¨I
    const d = new Date();
    const todayKey = `${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}`;
    const statusPath = `buttonStatus/${todayKey}`;

    links.forEach(name => {
      const btn = document.createElement("button");
      btn.textContent = "Ph√°t " + name;
      btn.className = "audio-btn";
      
      const btnRef = ref(db, `${statusPath}/${name}`);

      // L·∫ÆNG NGHE ƒê·ªîI M√ÄU (M√°y kh√°c b·∫•m l√† m√°y n√†y ƒë·ªè)
      onValue(btnRef, (snapshot) => {
        if (snapshot.val() === true) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });

      btn.onclick = () => {
        // 1. Ph√°t nh·∫°c
        audio.src = `https://ttytgt-creatorvinhpham.github.io/ungdungyte/audio_xt/${name}.mp3`;
        audio.play().catch(() => console.log("L·ªói nh·∫°c"));
        
        // 2. Ghi l√™n Firebase
        set(btnRef, true);
      };
      container.appendChild(btn);
    });

    window.resetAll = () => {
      if(confirm("L√†m m·ªõi danh s√°ch (X√≥a h·∫øt m√†u ƒë·ªè)?")) {
        remove(ref(db, statusPath));
      }
    };

    window.playTTS = () => {
      const txt = document.getElementById("ttsInput").value;
      if (!txt) return;
      audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodeURIComponent(txt)}&tl=vi`;
      audio.play();
    };
  </script>
</body>
</html>
