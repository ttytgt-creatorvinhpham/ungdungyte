<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>G·ªçi B·ªánh Nh√¢n - Xu√¢n Tr∆∞·ªùng</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f4f8; margin: 20px; text-align: center; }
    h1 { background-color: #1976D2; color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .button-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
    button.audio-btn { 
      width: 130px; height: 55px; background-color: #2196F3; color: white; 
      font-size: 14px; font-weight: bold; border: none; border-radius: 8px; 
      cursor: pointer; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    /* M√ÄU ƒê·ªé KHI ƒê√É ·∫§N (ƒê·ªíNG B·ªò TH·ªúI GIAN TH·ª∞C) */
    button.audio-btn.active { background-color: #d32f2f !important; box-shadow: inset 0 3px 5px rgba(0,0,0,0.3); transform: scale(0.95); }
    
    .tts-section { margin-top: 40px; padding: 20px; background: white; border-radius: 15px; display: inline-block; width: 90%; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .tts-input { width: 60%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
    .tts-btn { padding: 12px 25px; background-color: #ff9800; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-left: 10px; }
    .reset-btn { position: fixed; bottom: 20px; right: 20px; padding: 15px; background: #455a64; color: white; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; z-index: 100; }
  </style>
</head>
<body>

  <h1>üè• H·ªÜ TH·ªêNG G·ªåI B·ªÜNH NH√ÇN - XU√ÇN TR∆Ø·ªúNG</h1>
  
  <div class="button-container" id="buttonContainer"></div>

  <div class="tts-section">
    <h3>G·ªçi t·ª± do (G√µ t√™n b·ªánh nh√¢n)</h3>
    <input type="text" class="tts-input" id="ttsInput" placeholder="V√≠ d·ª•: M·ªùi b·ªánh nh√¢n Nguy·ªÖn VƒÉn A">
    <button class="tts-btn" onclick="window.playTTS()">G·ªåI NGAY</button>
  </div>

  <button class="reset-btn" onclick="window.resetAll()">üîÑ L√ÄM M·ªöI (SANG BU·ªîI M·ªöI)</button>
  <audio id="audioPlayer"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA0n0eH-9YOeqmNhQZQooc_wmbQhq9j718",
      authDomain: "ung-dung-y-te-8289b.firebaseapp.com",
      databaseURL: "https://ung-dung-y-te-8289b-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ung-dung-y-te-8289b",
      storageBucket: "ung-dung-y-te-8289b.firebasestorage.app",
      appId: "1:291727072122:web:7109ad07009512337214c3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const links = [
      "1-2", "3-4", "5-6", "7-8", "9-10", "11-12", "13-14", "15-16", "17-18", "19-20",
      "21-22", "23-24", "25-26", "27-28", "29-30", "31-32", "33-34", "35-36", "37-38", "39-40",
      "41-42", "43-44", "45-46", "47-48", "49-50", "51-52-53", "54-55-56", "57-58-59", "60-61-62", "63-64-65",
      "66-67-68", "69-70-71", "72-73-74", "75-76-77", "78-79-80", "81-82-83", "84-85-86", "87-88-89", "90-91-92", "93-94-95",
      "96-97-98", "99-100-101", "102-103-104", "105-106-107", "108-109-110", "111-112-113", "114-115-116", "117-118-119", "120-121-122", "123-124-125",
      "126-127-128", "129-130-131", "132-133-134", "135-136-137", "138-139-140", "141-142-143", "144-145-146", "147-148-149", "150-151-152", "153-154-155",
      "156-157-158", "159-160-161", "162-163-164", "165-166-167", "168-169-170", "171-172-173", "174-175-176", "177-178-179", "180-181-182", "183-184-185",
      "186-187-188", "189-190-191", "192-193-194", "195-196-197", "198-199-200", "201-202-203", "204-205-206", "207-208-209", "210-211-212", "213-214-215",
      "216-217-218", "219-220-221", "222-223-224", "224-226-227", "228-229-230", "231-232-233", "234-235-236", "237-238-239", "240-241-242", "243-244-245"
    ];

    const container = document.getElementById("buttonContainer");
    const audio = document.getElementById("audioPlayer");
    const today = new Date().toLocaleDateString('en-GB').replace(/\//g, "-");
    const path = `bv_xuan_truong/${today}`;

    // T·∫†O N√öT B·∫§M
    links.forEach(name => {
      const btn = document.createElement("button");
      btn.id = "btn-" + name; // G√°n ID ƒë·ªÉ d·ªÖ t√¨m n√∫t v√† ƒë·ªïi m√†u
      btn.textContent = name;
      btn.className = "audio-btn";
      
      const audioUrl = `https://ttytgt-creatorvinhpham.github.io/ungdungyte/audio_xt/${name}.mp3`;
      const btnRef = ref(db, `${path}/${name}`);

      // L·∫ÆNG NGHE FIREBASE (M√ÅY N√ÄO ·∫§N TH√å T·∫§T C·∫¢ C√ÅC M√ÅY C√íN L·∫†I ƒê·ªÄU ƒê·ªîI M√ÄU)
      onValue(btnRef, (snapshot) => {
        if (snapshot.val()) {
            btn.classList.add("active");
        } else {
            btn.classList.remove("active");
        }
      });

      btn.onclick = () => {
        // 1. Ph√°t nh·∫°c t·∫°i m√°y ƒëang ·∫•n
        audio.src = audioUrl;
        audio.play().catch(() => {
             // Th·ª≠ link d·ª± ph√≤ng n·∫øu file b·ªã ƒë·∫∑t t√™n l√† .mp3.mp3
             audio.src = audioUrl + ".mp3";
             audio.play().catch(() => console.log("L·ªói file nh·∫°c"));
        });

        // 2. G·ª≠i t√≠n hi·ªáu l√™n Firebase ƒë·ªÉ c√°c m√°y kh√°c c√πng ƒë·ªè
        set(btnRef, true);
      };
      container.appendChild(btn);
    });

    // H√ÄM RESET C·∫¢ DANH S√ÅCH
    window.resetAll = () => {
        if(confirm("L√†m m·ªõi danh s√°ch (X√≥a h·∫øt m√†u ƒë·ªè)?")) {
            remove(ref(db, path));
        }
    }

    // H√ÄM G·ªåI T·ª∞ DO (TTS)
    window.playTTS = () => {
      const text = document.getElementById("ttsInput").value;
      if (!text) return;
      audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodeURIComponent(text)}&tl=vi`;
      audio.play();
    };
  </script>
</body>
</html>
